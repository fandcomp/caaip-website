---
---

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Admin - CAAIP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .login-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
  </style>
</head>
<body class="login-bg min-h-screen flex items-center justify-center">
  <div id="login-section" class="max-w-md w-full mx-4">
    <!-- Logo Section -->
    <div class="text-center mb-8">
      <div class="flex justify-center items-center mb-6">
        <img src="/images/logo-itb.png" alt="Logo CAAIP" class="h-16 w-auto mr-4">
        <img src="/images/kemenhub.png" alt="Logo Kemenhub" class="h-12 w-auto">
      </div>
      <h1 class="text-3xl font-bold text-white mb-2">Admin Panel CAAIP</h1>
      <p class="text-gray-200">Masuk untuk mengelola konten website</p>
    </div>

    <!-- Login Form -->
    <div class="bg-white rounded-lg shadow-2xl p-8">
      <form id="loginForm" class="space-y-6">
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
            Username
          </label>
          <input
            type="text"
            id="username"
            name="username"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
            placeholder="Masukkan username"
          >
        </div>

        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
            Password
          </label>
          <input
            type="password"
            id="password"
            name="password"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
            placeholder="Masukkan password"
          >
        </div>

        <button
          type="submit"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
        >
          Masuk ke Admin Panel
        </button>

        <div class="mt-4 text-center">
          <p class="text-sm text-gray-600 mb-2">Atau masuk dengan</p>
          <button
            type="button"
            onclick="loginWithGitHub()"
            class="w-full bg-gray-800 hover:bg-gray-900 text-white font-semibold py-3 px-4 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 flex items-center justify-center"
          >
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"></path>
            </svg>
            GitHub
          </button>
        </div>
      </form>

      <!-- Error Message -->
      <div id="errorMessage" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
          </svg>
          <span id="errorText">Username atau password salah!</span>
        </div>
      </div>

      <!-- Success Message -->
      <div id="successMessage" class="mt-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-lg hidden">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <span>Login berhasil! Mengalihkan...</span>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-8 text-white/80">
      <p class="text-sm">&copy; 2025 CAAIP - Pusat Pendidikan dan Pelatihan Transportasi Udara</p>
    </div>
  </div>

  <!-- Already Logged In Section -->
  <div id="logged-in-section" class="max-w-md w-full mx-4 hidden">
    <div class="bg-white rounded-lg shadow-2xl p-8 text-center">
      <div class="text-6xl mb-4">âœ…</div>
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Sudah Login</h1>
      <p class="text-gray-600 mb-6">Anda sudah terautentikasi sebagai admin</p>

      <div class="space-y-3">
        <button
          onclick="goToAdmin()"
          class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
        >
          Masuk ke Admin Panel
        </button>

        <button
          onclick="logout()"
          class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
        >
          Logout
        </button>
      </div>
    </div>
  </div>

  <script>
    // Simple authentication
    const VALID_USERNAME = 'admin';
    const VALID_PASSWORD = 'admin123';

    const loginForm = document.getElementById('loginForm');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const loginSection = document.getElementById('login-section');
    const loggedInSection = document.getElementById('logged-in-section');

    function showError(message) {
      errorMessage.querySelector('#errorText').textContent = message;
      errorMessage.classList.remove('hidden');
      successMessage.classList.add('hidden');
    }

    function showSuccess() {
      successMessage.classList.remove('hidden');
      errorMessage.classList.add('hidden');
    }

    function hideMessages() {
      errorMessage.classList.add('hidden');
      successMessage.classList.add('hidden');
    }

    // Check if already authenticated
    function checkAuth() {
      const isAuthenticated = localStorage.getItem('admin_authenticated') === 'true';
      const loginTime = localStorage.getItem('admin_login_time');

      if (!isAuthenticated || !loginTime) {
        return false;
      }

      // Check if login is still valid (24 hours)
      const now = Date.now();
      const loginTimestamp = parseInt(loginTime);
      const hoursDiff = (now - loginTimestamp) / (1000 * 60 * 60);

      if (hoursDiff > 24) {
        // Login expired, clear storage
        localStorage.removeItem('admin_authenticated');
        localStorage.removeItem('admin_login_time');
        return false;
      }

      return true;
    }

    // Show appropriate section
    function showSection() {
      if (checkAuth()) {
        loginSection.classList.add('hidden');
        loggedInSection.classList.remove('hidden');
      } else {
        loginSection.classList.remove('hidden');
        loggedInSection.classList.add('hidden');
      }
    }

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideMessages();

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      // Validate credentials
      if (username === VALID_USERNAME && password === VALID_PASSWORD) {
        showSuccess();

        // Store authentication status
        localStorage.setItem('admin_authenticated', 'true');
        localStorage.setItem('admin_login_time', Date.now().toString());

        // Redirect to admin panel after short delay
        setTimeout(() => {
          window.location.href = '/admin/';
        }, 1500);
      } else {
        showError('Username atau password salah!');
      }
    });

    // Go to admin panel
    function goToAdmin() {
      window.location.href = '/admin/';
    }

    // Logout function
    function logout() {
      localStorage.removeItem('admin_authenticated');
      localStorage.removeItem('admin_login_time');
      showSection();
    }

    // GitHub OAuth login
    function loginWithGitHub() {
      // GitHub OAuth App configuration
      const clientId = 'Ov23li2q8wQXh8q8wQXh'; // This should be from environment variable
      const redirectUri = `${window.location.origin}/api/auth`;
      const scope = 'repo';
      const state = Math.random().toString(36).substring(7);

      // Store state for CSRF protection
      localStorage.setItem('oauth_state', state);

      // Redirect to GitHub OAuth
      const githubUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${scope}&state=${state}`;
      window.location.href = githubUrl;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      showSection();
      if (!checkAuth()) {
        document.getElementById('username').focus();
      }
    });
  </script>
</body>
</html>